---
title: "Regression with R Exercises"
author: "Victor Z. Nygaard"
abstract: |
  This document is to meant to convey the results of exercises for the UCPH masters course on Regression.
header-includes:
   - \usepackage[utf8]{inputenc}
   - \usepackage{verbatim}
   - \usepackage[language]{babel}
   - \usepackage[encoding]{inputenc}
   - \usepackage{hyperref}
   - \usepackage{amsmath}
   - \usepackage{mathtools}
   - \usepackage{amssymb}
   - \usepackage{mathtools}
   - \usepackage{nicefrac}
   - \usepackage{fullpage}
   - \usepackage{stmaryrd}
   - \usepackage{aligned-overset}
   - \usepackage{pdfpages}
date: "Last compiled on `r format(Sys.time(), '%d. %B, %Y')`"
# Hvordan får  vi den til at printe February i stedet for februar??????
output: html_document
---

------------------------------------------------------------------------

```{=html}
<!-- RMD tips:
1. CTRL+SHIFT+C RMD-comments-out the selected lines, with in a standard HTML comment-out format. 

2. CTRL+ALT+I inserts a new r codechunck

3. Pressing CTRL+SHIFT+ENTER when over a code chunck gives you a preview of the results of the chunck

4. CTRL+SHIFT+K gives you a preview of the entire resulting HTML file.

5. Note the different results of '#HS 1' and 
'# HS 1' (without the '') in the output

6. It is possible to compile regular R-scripts into Rmd files - this is done by pressing CTRL+SHIFT+K while attending any R-script. <<<- Though this apparently doesn't work for HS Problems.R for some reason!?!?!? ->>>

7. Selective use of the echo=c(...) option within code chuncks allows assignment of a variable, to show the assignment in the knitted document, and showing the value of the assignment seamlessly as well - see HS2.3

8. It is possible to include results of R-analysis such as summary statistics in LaTeX-equations in RMD, see HS2.3

9. Adding fig.align="center" to a code chunk centers any figures generated by the chunck.

9.1 note that properties of codechunks seem casesensitive; fig.align="center" centers a figure, but fig.align="Center" (with capital C) doesn't

10. A new subtitle needs a blank line before itself: 
'works:

#### HS 7
'

'doesn't:
blablabla
#### HS 7
'

'doesn't either:
<!-- blablabla ->
#### HS 7
'
11. Pressing F7 when marking, or hovering over a word will spellcheck the word

12. CTRL + - (minus) zooms out, CTRL + + (plus) zooms in

13. CTRL + D Deletes the current line, or current selection of lines

14. THE FOLLOWING SOURCE EDITOR FOLDING METHODS:
14.1 Collapse current fold: ALT + L
14.1.1: Expand current fold: SHIFT + ALT + L
14.2 Collapse "all" subfolds: ALT + O <- !?!! Note that this leaves a small letter 'o' in the text !!?!
14.2.1 Expand "all" subfolds: SHIFT + ALT + O
14.3 Collapse all other folds: ALT + 0 (zero)

15. SHIFT + ALT + J allows you to jump to specific parts of the document

16. Writing a new line with '...' will cause all previous output to be hidden in the knittet document

17. Writing (q<-5) around R code, will both assign and print the code upon assignment 

18. Note that 'attach' only has the scope of the current R-chunck.

19. One way to get pdf printout is to compile a html-printout, and then, in-browser, 'print' the HTML page as a pdf.

20. CTRL + SHIFT + M gives the pipe operator.

21. Pressing CTRL + F3 searches on the selected word.

22. CTRL

23. ALT + SHIFT + DOWN copies a line to below.

24. CTRL + ALT + K highlights all similar words in block for editing.

25. `utils::browseURL(getwd())` opens the working directory in windows explorer

26. `git commit -a -m "commit message"` as implemented within the (git) terminal (can be accessed within the git menu in RStudio via the "More" (gear icon)) commits all (-a) files within the perview of git using the message (-m) "commit message"

27. `git push` as implemented within the (git) terminal pushes the commit, as standard and when in a RProject, to the repository's main branch, unless otherwise specified.
-->
```
<!-- ---?--- How do I create a closeable Rmd section, such that I do not have to scroll through the LaTeX commands each time? - !!! Can be done with '-----' through this also creates a line in the knittet document. -->

<!-- How do I publish and share the HTML as a viewable (and linkable) website - this can be done through github? -->

<!-- How can I share R markdown files such that multiple people can edit them at the same time? -->

<!-- Do we need parindent controls as in LaTeX? -->

<!-- Use of the cache function to reduce recompile times -->

<!-- How to close current subsection with a keyboard shortcut? How to close subsubsections,...? - !!!See RMD tip 14!!! -->

<!-- Chunk naming? -->

<!-- How to define variables such that they have scope within their own ## segment? -->

<!-- How do I delete all non-needed variables for each new section in R??? -->

<!-- LaTeX commands -->

\newcommand{\C}{\mathbb{C}}

<!--- Komplekse tal --->

\newcommand{\R}{\mathbb{R}}

<!--- Reelle tal--->

\newcommand{\Q}{\mathbb{Q}}

<!---Rationelle tal--->

\newcommand{\Z}{\mathbb{Z}}

<!---Hele tal--->

\newcommand{\N}{\mathbb{N}}

<!---Naturlige tal--->

<!---mean--->

\newcommand{\F}{\mathbb{F}}

<!---Baggrundsrum sigma-alg--->

\newcommand{\B}{\mathbb{B}}

<!---Borel sigma--->

\newcommand{\K}{\mathbb{K}}

<!---Generel field--->

\newcommand{\RB}{\overline{\R}}

<!---Udvidede reelle tal--->

\newcommand{\ms}[1]{\mathscr{#1}}
\newcommand{\mc}[1]{\mathcal{#1}}

<!---Arrows -->

\newcommand{\ra}{\rightarrow}

<!---Konvergens pil højre -->

\newcommand{\nra}{\nrightarrow}

<!---ikke Konvergens pil højre -->

\newcommand{\la}{\leftarrow}

<!---Konv pil venstre -->

\newcommand{\nla}{\nleftarrow}

<!---ikke Konvergens pil venstre -->

\newcommand{\lra}{\leftrightarrow}

<!---højre venstre pil -->

\newcommand{\nlra}{\nleftrightarrow}

\newcommand{\Ra}{\Rightarrow}

<!---Implikations pil højre -->

\newcommand{\Lra}{\Leftrightarrow}

<!---Bi-implikations pil -->

\newcommand{\Uda}{\Updownarrow}

<!---Bi-implikations pil (op og ned) -->

\newcommand{\Da}{\Downarrow}

<!---implikations pil (ned) -->


\newcommand{\eqd}{\overset{d.}{=}}

<!--- Parenteser --->

\newcommand{\lrp}[1]{\mathopen{}\left({#1}\right)\mathclose{}}

<!-- \left("STUFF"\right) -->

\newcommand{\lrc}[1]{\mathopen{}\left\{{#1}\right\}\mathclose{}}

<!-- \left\{"STUFF"\right\} -->

\newcommand{\lrs}[1]{\mathopen{}\left[{#1}\right]\mathclose{}}

<!-- \left["STUFF"\right] -->

\newcommand{\lrb}[1]{\mathopen{}\left|{#1}\right|\mathclose{}}

<!-- \left|"STUFF"\right| -->

\newcommand{\inner}[2]{\mathopen{}\left\langle #1, #2 \right\rangle\mathclose{}}

<!-- <\left"STUFF1","STUFF2"\right> -->

\newcommand{\norm}[1]{\mathopen{}\left\lVert#1\right\rVert\mathclose{}}

<!-- \left||"STUFF"\right|| -->

\newcommand{\floor}[1]{\lfloor #1 \rfloor}

<!---Floor function --->

\newcommand{\ceil}[1]{\lceil #1 \rceil}

<!---ceil --->

\newcommand{\ep}{\varepsilon}

<!-- \newcommand{\Rlogo}{![](../Data/R_logo.png){#id .class width=auto height=16px} } <!-- R logo implemented in text -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = TRUE)
knitr::opts_chunk$set(fig.align = 'center')
options(warnPartialMatchDollar = TRUE) #see ADV-R chapter 4.3.2
library(tidyverse)
library(gridExtra)
theme_set(theme_minimal())
library(MASS) #Has a conflict with dplyr regarding select.
library(reshape2)
library(caret) #Used for Machine Learning
#library(plot.matrix) 
library(Matrix)
library(expm)
#library(plotly) #for 3D plotting
#library(reticulate) #Used for saving plotly images
#library(nloptr) #optimisation
#library(lpSolve) #linear programming
library(microbenchmark)
library(scales) #used for log trans of ggplot
#library(stats4) #mle and stuff
library(conflicted) #provides warnings when matching function available in multiple namespaces

### For Regression course:
library(ggplot2)   ## Grammar of graphics
library(reshape)   ## Reshaping data frame
library(lattice)   ## More graphics
library(hexbin)    ## and more graphics
library(gridExtra) ## ... and more graphics (placing graphs adjecent)
library(xtable)    ## LaTeX formatting of tables
library(splines)   ## Splines
library(survival)  ## Survival analysis
library(grid)      ## For `unit`
library(lpSolve)   ## Linear programming
library(RwR)       ## Regression with R package

set.seed(314)
```

# Chapter 2: The linear model

```{r}
claims <- read.table(
  "http://www.math.ku.dk/~richard/regression/data/claims.txt", 
  sep = ";",
  colClasses = c("character", "numeric", "numeric", "factor")
)
```

```{r}
head(claims)
claims %>% tail()
```

```{r}
p0 <- qplot(sum, claims, data = claims, alpha = I(0.2)) +
  scale_x_log10("Insurance sum (DKK)", 
                breaks = 10^c(6, 7, 8),
                labels = c("1M", "10M", "100M")) +
  scale_y_log10("Claim size (DKK)", 
                breaks = 10^c(2, 4, 6, 8),
                labels = c("100", "10k", "1M", "100M"))
(p <- p0 + geom_smooth(method = "lm", linewidth = 1.5, se = FALSE))
```

```{r}
p + facet_wrap(~ grp, ncol = 4)
```

```{r}
claimsLm <- lm(I(log(claims)) ~ I(log(sum)), data = claims)
summary(claimsLm)
coefficients(claimsLm)
```
```{r}
model.matrix(claimsLm)[781:784,]
```
```{r}
claimsLmAddUnres <- lm(I(log(claims)) ~ I(log(sum)) + grp, data = claims)
summary(claimsLmAddUnres)
coefficients(claimsLmAddUnres)
```
```{r}
model.matrix(claimsLmAddUnres)[781:784, ]
```

```{r}
claimsLmAdd <- lm(I(log(claims)) ~ I(log(sum)) + grp, data = claims,
                                      contrasts = list(grp = "contr.sum"))

summary(claimsLmAdd)
coefficients(claimsLmAdd)
```
```{r}
model.matrix(claimsLmAdd)[781:784, ]
```

```{r}
claimsLmInt <- lm(I(log(claims)) ~ I(log(sum)) * grp, data = claims)
claimsLmInt %>% summary
claimsLmInt %>% coefficients
```

```{r}
model.matrix(claimsLmInt)[781:784, ]
```

```{r}
claimsDiagnos <- fortify(claimsLm)
claimsDiagnos %>% head()
```


```{r}
grid.arrange(
  qplot(.fitted, .resid, data = claimsDiagnos, alpha = I(0.2)) +
    geom_smooth(),
  qplot(.resid, data = claimsDiagnos, bins = I(40)),
  qplot(sample = .stdresid, data = claimsDiagnos, geom = "qq") +
          geom_abline(),
  ncol = 3
)
```


```{r}

```


# Chapter 3: Birth weight - a case study


# Chapter 4: Data analysis with regression models


# Chapter 5: Exponential dispersion models


# Chapter 6: Generalised linear models


# Chapter 7: Advertising - a case study


# Chapter 8: Existence and uniqueness


# Chapter 9: Model assessment


# Chapter 10: Interval estimation


# Chapter 11: Survival analysis

